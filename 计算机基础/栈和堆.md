---
date created: 2021-09-01 22:08
date modified: 2022-03-26 11:39
title: 栈和堆
---
## 堆栈

^2f0d5a

栈和堆是在代码运行时供使用的内存。

入栈比在堆上分配内存要快，因为入栈时无需操作系统为存储新数据去搜索内存空间，其位置总是在栈顶。在堆上分配内存时则需要做些额外工作，操作系统必须先找到一块足够存放数据的内存空间，并做一些记录为下一次分配做准备。

访问堆数据比访问栈数据慢，因为必须通过指针来访问。在内存跳转越少访问就越快
### 栈

^370c4a

栈中的所有数据都必须占用已知且固定大小，在编译时大小未知或大小可能变化的数据，需改为存储在堆上。
- 栈遵循先进后出原则
- 存储在栈上的数据基本都是局部变量、值类型、原始常量、指针、函数帧
- 栈的内存管理由操作系统完成
- 多线程程序上每个线程都有各自的栈
- 栈不能无限增长，大多数语言中对于存在栈上的值有大小限制
### 堆
堆是缺乏组织的：当向堆放入数据时，需要请求一定大小的空间。操作系统在堆的某处找到一块足够大的空间，把它标记为已使用，并返回一个表示该位置地址的指针。这一过程被称为 **在堆上分配内存**(allocating on the heap) ^c96037
- 堆在应用程序的线程之间共享
- 存储在堆上的数据是全局变量、引用类型（如：对象、字符串、map）
- 存在堆上的值没有大小限制，但分配给应用程序的内存有上限