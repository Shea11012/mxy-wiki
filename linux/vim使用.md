---
date created: 2021-12-03 20:20
date modified: 2021-12-03 20:20
title: vim使用
---
### vim 缓冲区

- 已载入缓冲区：`vim file1` 这个 file1 的内容将会被加载到缓冲区，这个缓冲区被称为**已载入的缓冲区**。
- 已激活缓冲区：如果在 vim 中保存 file1 文件，缓冲区的内容将会被同步到磁盘上。由于这个缓冲区也一直在一个窗口上显示，所以它也是一个**已激活的缓冲区**
- 隐藏缓冲区：通过 `:e file2` 加载了另一个文件，`file1` 将会变成一个**隐藏的缓冲区**，且 file2 变为已激活缓冲区
- 未命名缓冲区：是一种没有关联特定文件的缓冲区，这种缓冲区经常被插件使用。如 `:enew` 将会创建一个无名临时缓冲区。
- 已命名缓冲区：添加一些文本然后使用 `:w /tmp/foo` 将它写入磁盘，此时就变成了一个已命名缓冲区。

### 范围

| 命令              | 操作的行              |
| ----------------- | --------------------- |
| `:d` 和 `:.d`     | 当前行                |
| `:1d`             | 第一行                |
| `:$d`             | 最后一行              |
| `:1,$d` 和 `:%d`  | 所有行                |
| `:.,5d` 和 `:,5d` | 当前行至第 5 行         |
| `:,+3d`           | 当前行与接下来的 3 行   |
| `:1,+3d`          | 第一行至当前行再加 3 行 |

> `, 和 ;` 表示范围。区别在于 `a,b` 的 b 是以当前行作为参考的。而 `a;b` 的 b 是以 a 行作为参考。如，当前光标在第 5 行，`:1,+1d` 表示的是第 1 行至当前行外加一行（等于第 6 行），而 `:1;+1d` 会删除第 1 行和第 2 行。

### vi 常用命令

|         命令          |                             说明                             |
| :-------------------: | :----------------------------------------------------------: |
|   h 或向左箭头（←）    |                     光标向左移动一个字符                     |
|   j 或向下箭头（↓）    |                     光标向下移动一个字符                     |
|   k 或向上箭头（↑）    |                     光标向上移动一个字符                     |
|   l 或向右箭头（→）    |                     光标向右移动一个字符                     |
|           G           |                   移动到这个文件的最后一行                   |
|          nG           |                n 为数字，移动到这个文件的第 n 行                |
|          gg           |                    移动到这个文件的第一行                    |
|       n[Enter]        |                   n 为数字，光标向下移动 n 行                   |
|         /word         |                向下寻找一个名称为 word 的字符串                |
|         ?word         |                向上寻找一个名称为 word 的字符串                |
|           n           |                    **重复前一个查找操作**                    |
|           N           |                    反向进行前一个查找操作                    |
| :n1,n2s/word1/word2/g | n1 和 n2 为数字，在第 n1 与 n2 行之间寻找 word1 字符串，并将该字符串替换为 word2 |
|  :1,$s/word1/word2/g  |  从第一行到最后一行查找 word1 字符串，并将该字符串替换为 word2  |
| :1,$s/word1/word2/gc  | 从第一行到最后一行查找 word1 字符串，并将该字符串替换为 word2，且在替换前提示字符给用户确认是否替换 |
|         x，X          |      在一行字当中，x 向后删除一个字符，X 向前删除一个字符      |
|          nx           |                 n 为数字，连续向后删除 n 个字符                 |
|          dd           |                    删除光标所在的那一整行                    |
|          ndd          |                n 为数字，删除光标所在的向下 n 行                |
| d1G	| 删除光标所在当第一行的所有数据 |
| dG | 删除从光标所在到最后一行的所有数据 |
| yy | 复制光标所在那一行 |
| nyy | n 为数字，复制光标所在的向下 n 行 |
| p，P | p 为将已复制的数据在光标下一行粘贴，P 则为粘贴在光标上一行 |
| u | 复原前一个操作 |
| Ctrl + r | 重做上一个操作 |
| :w filename | 将编辑的文件保存为另一个文件（类似另存）|
| ZZ | 如果文件没有更动，则不保存离开，若文件已经被更动过，则保存后离开 |
| :r filename | 在编辑的数据中，读入另一个文件的数据，将这个文件内容加到光标所在行的后面 |
| :n1,n2 w filename | 将 n1 到 n2 的内容保存成 filename 这个文件 |
| :! command | 暂时离开 vi 到命令行模式下执行 command 的显示结果，例如 ：‘:! ls’ |
| :set nu | 显示行号，设置之后，会在每一行的前缀显示该行的行号 |
| :set nonu |  取消行号 |

#### 编辑模式 
| 命令 | 说明 |
| :---: | :---:|
| i，I | 进入插入模式，i 为从目前光标所在处插入，I 为目前所在行的第一个非空格符处开始插入 |
| a，A | 进入插入模式，a 为从目前光标所在的下一个字符处开始插入，A 为从光标所在行的最后一个字符处开始插入 |
| o，O | 进入插入模式，o 为在目前光标所在的下一行插入新的一行，O 为在目前光标所在处的上一行插入新的一行 |
| r，R | 进入替换模式，r 只会替换光标所在的那一个字符一次，R 会一直替换光标所在的文字，知道按下 ESC 键为止|

#### 多文件编辑

> :n	编辑下一个文件
> :N	编辑上一个文件
> :files	列出目前这个 vim 打开的所有文件

#### 块选择

> v		字符选择，会将光标经过的地方反白选择
> V		行选择，会将光标经过的行反白选择
> Ctrl+v	块选择，可以用长方形的方式选择数据
> y		将反白的地方复制起来
> d		将反白的地方删除

#### 多窗口功能
> :sp		打开一个新窗口，如果有加 filename，表示在新窗口打开一个新文件，否则表示两个窗口为同一个文件内容（同步显示）
> Ctrl+w+j		按键方法是：先按下 Ctrl 不放，再按下 w 后放开所有键，然后按下 j，则光标移动到下方的窗口
> Ctrl+w+k		同上，移动到上面的窗口
> Ctrl+w+q		结束离开，按:q 或 Ctr+w+q，都可以

#### vim 的环境设置与记录：~/.vimrc，~/.viminfo
常用环境参数：

| 命令 | 说明 |
| :----: | :----: |
| :set nu,:set nonu | 设置与取消行号 |
| :set hlsearch,:set nohlsearch | hlsearch 就是 high light search (高亮度查找)，设置是否将查找到的字符串反白的设置值，默认 hlsearch|
| :set autoindent，:set noautoindent | 是否自动缩排，默认 autoindent |
| :set backup | 是否自动保存备份文件，一般是 nobackup，如果设置 backup，那么当改动任何一个文件，则原文件会被另存成一个文件名为 filename~的文件|
| :set ruler | 是否显示右下角状态栏说明 |
| :set showmode | 是否显示 insert 之类的字眼在左下角状态栏 |
| :set backspace=( 012 ) | 可以利用退格键删除任意字符，某些 distribution 则不许如此，当 backspace 为 2 时，可以删除任意值；为 0 或 1 时，仅可删除刚才输入的字符，而无法删除原本就已经存在的文字|
| :set all | 显示目前所有环境参数设置值|
| :set | 显示与系统默认值不同的设置参数 |
| :syntax on，:syntax off | 是否开启根据相关语法显示不同颜色，语法检测 |
| :set bg=dark，:set bg=light | 显示不同的颜色色调|

### 替换命令

```shell
标志位：g（全局） i（大小写不敏感） c（需要确认）
%s/foo/bar/g # 在全局范围（%）查找 foo 并替换为 bar，所有的都会替换（g）
s/foo/bar/g # 当前行
'<,'>s/foo/bar/g # 在 Visual 模式下选择区域后
5,12s/foo/bar/g # 5-12行替换
.,+2s/foo/bar/g # 当前行与下两行，替换
```

