---
tags:
  - 数据库
  - gis
date created: 2023-11-12 23:15
date modified: 2023-11-13 02:34
---
PostGIS 是 PGSQL 的一个扩展，需要额外的安装

# 坐标系

## WGS84

ESPG 编码 4326，世界通用坐标系，GPS 设备得到的经纬度就是在 WGS84 坐标系下的经纬度

## CGCS2000

China Geodetic Coordinate System 2000，2000 国家大地坐标系
ESPG 编码 4490
非高精度的大多数情况下，我们可以认为 WGS84 坐标系=CGCS2000 坐标系
为了兼容性，在使用 CGCS2000 数据时，可以设置为 WGS84 坐标系

### GCJ02

为了数据安全和保密，通过地形图非线性保密处理算法（俗称火星加密）加密过的 WGS84 坐标系，俗称国测局坐标系，或火星坐标系。

GCJ02 坐标系与 WGS84 坐标系之间的偏差大概在 50-700m 左右。
谷歌（国内）、高德、腾讯都是这种坐标系。

### BD09

百度地图坐标系，在 GCJ02 的基础上又增加了一次偏移

# Geometry & Geography

| 对比项   | geometry                                                                 | geography                                                  |
| -------- | ------------------------------------------------------------------------ | ---------------------------------------------------------- |
| 名称     | 几何对象                                                                 | 地理对象                                                   |
| 坐标系   | 平面坐标系和球面坐标系                                                   | 球面坐标系                                                 |
| 单位     | 视坐标系，不同的坐标系的单位不同，如 EPSG:3857 单位为米，EPSG:4326 单位为度 | 一般度是比较常见的默认单位                                 |
| 函数限制 | 类型丰富                                                                 | 支持类型较少，仅支持类型转换、长度面积距离计算、交并差运算 |
| 索引类型 | 几何索引不能正确处理极地地区查询                                         | 地理索引可以正确处理覆盖极点或国际日期变更线的查询                                                           |

使用选择

| geometry                                                                         | geography                                               |
| -------------------------------------------------------------------------------- | ------------------------------------------------------- |
| 数据在地理范围上是紧凑的（包含在州、县或市内），推荐使用笛卡尔坐标的 geometry 类型 | 需要测量在地理范围上分散的数据集，推荐使用 geography 类型 |
| 数据存储，推荐使用 geometry                                                       | 在进行距离、面积等运算时，使用 geography                 |
| 需要具备更多的专业知识                                                           | 仅需要知道经纬度就可以计算                              |
| 需要运用大量复杂函数时，使用 geometry                                             | 支持函数较少，且计算复杂，需要占用较多 CPU                                                        |

## 互相转换

![[../assets/PostgreSQL/gis基础/IMG-20231113014035438.png]]

## 度转米

st_transform(st_setsrid(POINT(117.43597465998,33.609617443496)::geometry, 4326), 3857) --4326 转换成 3857 投影标准的平面坐标系，单位是米，与实际坐标一致 标准用法

## 米转度

st_transform(st_setsrid(POINT(13072912.8999608,3976502.86726954)::geometry, 3857), 4326) --3857 转换成 4326 投影标准的平面坐标系，单位是度，与实际坐标一致 标准用法

# 正确使用

建立表
```sql
create table t_pos(
	id int primary key,
	geom geometry(geometry,4490)
)

create gidx_t_pos_geom on t_pos using gist(geom)
```

插入数据时，转换为需要使用的坐标系
```sql
insert into t_pos values (1, ST_Transform(ST_GeomFromText('SRID=4326;POINT(116.34 39.92)'), 4490));    
insert into t_pos values (2, ST_Transform(ST_GeomFromText('SRID=4326;POINT(116.34 39.96)'), 4490));          
```

