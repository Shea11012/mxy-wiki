---
date created: 2021-12-03 20:20
date modified: 2021-12-03 20:20
title: gawk
---
## gawk
```bash
gawk options program file
```
命令行可用选项：
- -F fs 指定行中划分数据字段的字段分隔符
- -f file 从指定的文件中读取程序
- -v var=value 定义 gawk 程序中的一个变量及其默认值
- -mf N 指定要处理的数据文件中的最大字段数
- -mr N 指定数据文件中的最大数据行数
- -W keyword 指定 gawk 的兼容模式或警告等级

gawk 数据字段变量：`$0` 代表整行，`$1 -$n` 代表文本行中的 n 个数据字段。每个数据字段都是通过**字段分隔符划分** 。gawk 默认字段分隔符是任意的空白字符

在处理数据前运行脚本 `BEGIN` 关键字，`gawk 'BEGIN {print "Hello World!"}'` 

在处理数据后运行脚本 `END` 关键字

**使用花括号表示间隔，必须为 gawk 指定 --re-interval 选项**

`echo "bt" | gawk --re-interval '/be{1}t/{print $0}'` 

### 变量

gawk 使用两种变量：内建变量和自定义变量

**内建变量**

| 变量        | 描述                                             |
| ----------- | ------------------------------------------------ |
| FILEDWIDTHS | 由空格分隔的一列数字，定义了每个数据字段确切宽度 |
| FS          | 输入字段分隔符                                   |
| RS          | 输入记录分隔符                                   |
| OFS         | 输出字段分隔符                                   |
| ORS         | 输出记录分隔符                                   |

**数据变量**

| 变量       | 描述                                                   |
| ---------- | ------------------------------------------------------ |
| ARGC       | 当前命令行参数个数                                     |
| ARGIND     | 当前文件再 ARGV 中的位置                               |
| ARGV       | 包含命令行参数的数组                                   |
| CONVFMT    | 数字转换格式，默认 %.6 g                               |
| ENVIRON    | 当前 shell 环境变量及其值组成的关联数组                |
| ERRNO      | 当读取或关闭输入文件发生错误时的系统错误号             |
| FILENAME   | 用作 gawk 输入数据的数据文件的文件名                   |
| FNR        | 当前数据文件的数据行数                                 |
| IGNORECASE | 设成非零值时，忽略 gawk 命令中出现的字符串的字符大小写 |
| NF         | 数据文件的字段总数                                     |
| NR         | 已处理的输入记录数                                     |
| OFMT       | 数字的输出格式，默认值 %.6 g                           |
| RLENGTH    | 由 match 函数所匹配的子字符串的长度                    |
| RSTART     | 由 match 函数所匹配的子字符串的起始位置                |

**匹配操作：~**

```bash
$1 ~ /^data/  # 表示了匹配第一个数据字段开头包含 data 的数据
```

**数学表达式：**

```bash
gawk -F : '$4 == 0{print $1}' /etc/passwd 
# 表示匹配第4个数据字段值为 0 的数据行
```

**结构化命令：**正常的格式化语句

**格式化打印：gawk 使用 printf 打印，与 C 语言一致**

| 控制字母 | 描述                        |
| -------- | --------------------------- |
| c        | 将一个数作为 ASCII 字符显示 |
| d / i    | 显示一个整数值              |
| e / g    | 科学计数法显示一个数        |
| f        | 显示一个浮点值              |
| o        | 显示八进制                  |
| s        | 显示一个文本字符串          |
| x        | 十六进制                    |
| X        | 十六进制，使用大写的 A-F    |

### 内建函数：

#### 数学函数：

| 函数       | 描述                              |
| ---------- | --------------------------------- |
| atan2(x,y) | x/y 的反正切，x 和 y 以弧度为单位 |
| cos(x)     | x 的余弦，x 以弧度为单位          |
| exp(x)     | x 的指数函数                      |
| int(x)     | x 的整数部分，取靠近零一侧的值    |
| log(x)     | x 的自然对数                      |
| rand()     | 比 0 大比 1 小的随机浮点值        |
| sin(x)     | x 的正弦，x 以弧度为单位          |
| sqrt(x)    | x 的平方根                        |
| srand(x)   | 为计算随机数指定一个种子值        |

#### 字符串函数：

| 函数                | 描述                                                         |
| ------------------- | ------------------------------------------------------------ |
| asort(s,[,d])       | 将数组 s 数据按元素值排序。如果指定了 d ，排序后的数组会储存再数组 d 中 |
| asorti(s,[,d])      | 将数组 s 按索引值排序。生成的数组会将索引值作为数据元素值。  |
| gensub(r,s,h,[,t])  | 查找变量 $0 或目标字符串 t 来匹配正则表达式 r。如果 h 是一个以 g 或 G 开头的字符串，就用 s 替换掉匹配文本。如果 h 是一个数字，它表示要替换掉第 h 处 r 匹配的地方 |
| gsub(r,s,[,t])      | 查找变量 $0 或目标字符串 t 来匹配正则表达式，如果找到就全部替换成字符串 s |
| index(s,t)          | 返回字符串 t 在字符串 s 中的索引值，如果没找到返回 0         |
| length([s])         | 返回字符串 s 的长度，如果没有指定 s ，则返回 $0 的长度       |
| match(s,r,[,a])     | 返回字符串 s 中正则表达式 r 出现位置的索引。如果指定了数组 a，它会储存 s 中匹配正则表达式的那部分 |
| split(s,a,[,r])     | 将 s 用 FS 字符或正则表达式 r 分开放到数组 a 中，返回字段的总数 |
| sprintf(format,var) | 用提供的 format 和 var 返回一个类似 printf 输出的字符串      |
| sub(r,s,[,t])       | 在变量 $0 或目标字符串 t 中查找正则表达式 r 的匹配。如果找到就用 s 替换第一处匹配 |
| substr(s,i,[,n])    | 返回 s 中从索引值 i 开始的 n 个字符组成的子字符串。如果 n 未提供，则返回 s 剩下的部分。 |
| tolower(s)          | 转为小写                                                     |
| toupper(s)          | 转为大写                                                     |

#### 时间函数：

| 函数                          | 描述                                                         |
| ----------------------------- | ------------------------------------------------------------ |
| mktime(datespec)              | 将一个按 YYYY MM DD HH MM SS [DST] 格式指定的日期转成时间戳  |
| strftime(format,[,timestamp]) | 将当前时间的时间戳或 timestamp 转化格式化日期（采用 shell 函数的 date() 格式） |
| systime()                     | 返回当前时间的时间戳                                         |

