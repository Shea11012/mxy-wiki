## 位运算基本概念

1.  二进制的最高位是符号位：0 表示正数，1 表示负数
    
2.  正数的原码，反码，补码都一样
    
3.  负数的反码 = 它的原码符号位不变，其它位取反（0->1,1->0）
    
4.  负数的补码 = 它的反码+1
    
5.  0 的反码，补码都是0
    
6.  计算机在运算时，都是以补码的方式在运算
    

tips：PHP 没有无符号数，换言之，PHP 中的数都是有符号的。

运算步骤：原码->反码->补码（仅针对于负数），正数的原码，反码，补码都一样

### 二进制加减乘除运算法则

#### 减法：

> 0 - 0 = 1 - 1 = 0
> 
> 1 - 0 = 1
> 
> 0 - 1 = 1（向高位借位）

#### 加法：

> 0 + 0 = 0
> 
> 0 + 1 = 1 + 0 = 1
> 
> 1 + 1 = 0（向高位进位）

#### 乘法：

> 0 * 0 = 0
> 
> 0 * 1 = 1 * 0 = 0
> 
> 1 * 1 = 1

#### 除法：

> 0 / 1 = 0（1 / 0 无意义）
> 
> 1 / 1 = 1

### &（与） 运算

通常用于二进制取位操作，如： `num & 1` 结果就是取二进制的最末位。这可以用来判断一个整数的奇偶，二进制的最末位为 0 表示该数为偶数，为 1 表示该数为奇数，（与运算同位同时为 1，结果才为 1，否则为 0）

**tips：**

> 同位同为 1，则为1，同位同为 0，则为 0，同位相反，则为 1

### |（或） 运算

通常用于二进制特定位上的无条件赋值，如 `num | 1` 的结果就是把二进制最末位强行变成 1，对这个数 or 1 之后再减 1 就可以了，其实际意义就是把这个数强行变成最接近的偶数。（或运算同位只要有一个为 1，其值为 1）

### ^（异或） 运算

通常用于对二进制的特定一位进行取反操作，因为异或可以这样定义：0 和 1 异或 0 都不变，异或 1 则取反，如：

 a = 3  
 b = 4  
 a^=b^=a^=b // 一些语言可以这样写  
 // 一些语言得分开写  
 a ^= b  
 b ^= a  
 a ^= b 

其实际意义就是不用临时变量交换两个数 （异或运算，如果同位,值不同，则该结果为 1，否则为 0）

例:

 0^0 = 0  
 0^1 = 1  
 1^0 = 1  
 1^1 = 0

### ~（取反） 运算

是把内存中的 0 和 1 全部取反

### << （左移） 运算

a << b ，表示将 a 的位向左移动 b 次（每一次移动都表示乘以 2），实际上就是 a 乘以 2 的 b 次方，乘以 2 的操作尽量用左移一位代替

### >> （右移）运算

a >> b，表示将 a 的位向右移动 b 次（每次移动都表示除以 2），相当于 a 除以 2 的 b 次方（取整）。常用语 二分查找、堆的插入操作，也可以代替取余运算


## 位操作符

- `&` 与运算，两个位都是 1 时，结果才为 1，否则为 0 `10011 & 11001 = 10001`
- `|` 或，两位都是 0 时，结果才为 0
- `^` 异或运算，两个位相同则为 0，不同则为 1 `10011 ^ 11001 = 01010`
- `~` 取反运算，0 则变为 1，1 则变为 0，`~10011 = 01100`
- `<<` 左移运算，向左进行移位操作，高位丢弃，低位补 0

```c
int a = 8;
a << 3;
// 移位前：0000 0000 0000 0000 0000 0000 0000 1000
// 移位后：0000 0000 0000 0000 0000 0000 0100 0000
// 结果等于 a * 2^3 = 64
```

- `>>` 右移运算，向右移位操作，对无符号数，高位补 0，对有符号数，高位补符号位

```go
var a uint = 8
a >> 3
// 移位前：0000 0000 0000 0000 0000 0000 0000 1000
// 移位后：0000 0000 0000 0000 0000 0000 0000 0001

var a int = 8
a >> 3
// 移位前：1111 1111 1111 1111 1111 1111 1111 1000
// 移位后：1111 1111 1111 1111 1111 1111 1111 1111

// 结果等于：a / 2^3 = 1/-1
```

### 位运算操作

#### 交换两个数

```go
var a int = 3
var b int = 4
a ^= b
b ^= a
a ^= b
```

#### 判断奇偶数

**只要根据数的最后一位是 0 还是 1 来决定即可，为 0 是偶数，为 1 是奇数**

```go
if 0 == (a & 1) {
  // 偶数
}
```

#### 交换符号

**整数取反加 1，正好变成其对应的负数；负数取反加 1，则变为其原码，即正数**

```go
~a + 1
```

#### 求绝对值

```go
// 方法一
i := a >> 31 // 整数右移 31 位得到 0，负数右移 31 位得到 -1
if i == 0 { // 根据符号位进行相应的操作
  fmt.Println(a)  // 整数的绝对值是本身
} else {
  fmt.Println(~a + 1) // 负数的绝对值，先进行求反操作然后加 1
}

// 方法二
i := a >> 31 // 因为符号位只有 0 或 1 两个情况
((a ^ i) - i) // a 先是与 i 进行取反,与 0 取反则数不变，与 -1 取反则相当于对这个数取反，然后再减 i，i 为 0 值不变，为 -1 则加 1
```

#### 进行高低位交换

```go
// 给定一个 16 位的无符号整数，将其高 8 位与低 8 位进行交换
var a uint16 = 100
fmt.Println( (a >> 8) | (a << 8))
```

#### 二进制逆序

```
数 34520 的二进制表示
10000110 11011000

逆序后则为
00011011 01100001
```

```go
var a uint16 = 34520
a = ((a & 0xAAAA) >> 1) | ((a & 0x5555) << 1) // 取 a 的奇数位并用 0 填充 a & 0xAAAA,取偶数位 a & 0x5555,在将奇数右移一位，偶数左移一位，再将两个数据相或可以进行奇偶位上数据交换，依次类推
a = ((a & 0xCCCC) >> 2) | ((a & 0x3333) << 2)
a = ((a & 0xF0F0) >> 4) | ((a & 0x0F0F) << 4)
a = ((a & 0xFF00) >> 8) | ((a & 0x00FF) << 8)
```

#### 统计二进制中1个数

```go
count := 0
for a != 0 {
  a = a & (a - 1)
  count++
}
```

