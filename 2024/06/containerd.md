---
created: 2024-06-10 16:05
tags:
  - container
  - linux
updated: 2024-06-12 01:29
---
云原生技术栈的组成部分：
- 容器编排引擎：k8s 向上对接容器管理平台，提供容器编排接口，向下通过容器运行时接口、容器存储接口、容器网络接口打通与物理基础设施的联动
- 容器运行时：通过 namespace、cgroup 操作计算资源，为进程设置安全、隔离和可计量的执行环境
- 容器存储：通过容器存储层抽象屏蔽不同介质的存储资源，通过提供持久化的存储卷为有状态的容器应用提供存储服务
- 容器网络：通过 CNI 接口屏蔽底层网络实现，方便接入多种不同网络方案

![[../../Excalidraw/Drawing 2024-06-10 19.26.40.excalidraw]]


| 类目     | 虚拟机                   | 容器                    |
| ------ | --------------------- | --------------------- |
| 封装     | 整个操作系统、内核及 lib         | 操作系统之上的 lib       |
| 性能     | 有一层虚拟化开销              | 本机性能                  |
| 接口     | hypervisor 与底层操作系统协调   | 容器运行时与底层操作系统协调        |
| 虚拟化层次  | 硬件级虚拟化                | 操作系统虚拟化，通过 namespace 隔离 |
| 额外开销   | geust OS 的存在，额外占用内存    | 极少的额外开销               |
| 资源利用率  | gues OS 的额外开销 + 虚拟化的性能损耗 | 资源利用率高                |
| 轻量     | 虚拟机占用存储空间大            | 占用小                   |
| 启动速度   | 慢                     | 快                     |
| 安全性    | 完全独立的操作系统和内核，安全性高     | 进程级隔离，共享内核，安全性较低      |
| 灵活性    | 不灵活                   | 较灵活                   |
| 应用交付速度 | 交付慢                   | 交付快                   |

## docker 架构

![[../../Excalidraw/docker架构|docker架构]]

- docker client: 负责用户和 docker daemon 建立通信
- docker daemon: 常驻进程，接收请求、分发请求，也负责镜像构建、卷管理、日志等功能
- containerd: 负责容器运行时和生命周期（创建、启动、停止、中止、删除等）

## containerd 架构

### ecosystem（生态层）

- platform：平台层，作为工业标准容器运行屏蔽底层差异向上支持多个平台，如谷歌 GCP、亚马逊 Fargate、微软 Azure 等
- Client：连接 containerd 的适配层，客户端通过 grpc 调用 containerd 服务端的 API

### containerd 内部架构

- API 层：提供 GRPC 接口和 Prometheus 数据采集接口
- Core 层：核心逻辑层，包含服务和元数据
- Backend 层：对接操作系统容器运行时，支持通过不同的 plugin 扩展，containerd 通过 shim 对接不同的容器运行时，如 kata、runc、gVisor 等

### system 系统层

主要是 containerd 支持的底层操作系统及架构