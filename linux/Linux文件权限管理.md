---
tags: ["linux 权限"]
date created: 2021-12-03 20:20
date modified: 2023-02-08 00:22
---

### 文件权限位置

/etc/passwd：文件包含了一些用户有关的信息

/etc/shadow： 管理登录用户的密码 

/etc/group：存储了用户组的信息

/etc/login.defs：在创建用户时对用户的一些通用设置

### 文件、目录的权限

#### linux 文件权限

r —— 4

w —— 2

x —— 1

创建文件默认权限：-rw-r-r

目录默认权限：drwx-r-x-r-x

链接文件默认权限 lrwxrwxrwx

umask 指定文件与目录默认权限，默认 0022（去掉了 w 权限）

```
[-][rwx][r-x][r--][1][root][root][238][Jun 18 17:22][test.txt]
 1	2	 3	  4	  5	   6	7	  8	  		9		  10
```

1：`[-]` 代表文件，`[d]` 代表目录，`[l]` 代表链接文件，`[b]` 代表设备文件里可供存储的接口设备，`[c]` 表示设备文件的串行端口设备，例如键盘、鼠标

2：拥有者权限

3：同用户组用户权限

4：其他用户权限

5：表示有多少文件名连接到此节点

6：表示这个文件或目录的所有者账号

7：表示这个文件的所属用户组

8：表示这个文件的容量大小

9：表示这个文件的创建日期或者最近的修改日期

10：表示文件名

#### 文件权限符

- \- 表示文件
- d 表示目录
- l 表示链接
- c 表示字符型设备
- b 表示块设备
- n 表示网络设备

#### 默认的文件权限

umask 022

umask ：用于设置用户在创建文件时的默认权限，对于 root 用户（UID 小于 200 的 user，默认的 umask 值是 022），对于普通用户和系统用户，系统默认的 umask 值是 002，默认设置是写在 /etc/profile 和 /etc/bashrc 环境配置文件中

### 文件扩展 ACL 权限

在计算机相关领域，所有的 ACL （access control list）都表示访问控制列表

扩展 ACL 可以针对单一使用者，单一档案或目录里的默认权限进行 r，w，x 的权限规范

查看文件系统是否开启 ACL 功能 ：`dumpe2fs -h /dev/sda2 | grep -i acl`

setfacl ：设置 ACL

getfacl ：查看 ACL

ACL:mask ：设置 mask 后会将 mask 权限与已有的 acl 权限进行计算

#### 文件隐藏属性

隐藏属性 i 设置后，可以让一个文件不能被删除、改名、设置链接，也无法写入或新增数据。该属性只能由 root 设置。
```shell
chattr +i file
lsattr file
```

具体属性可以查看 `man chattr`

chattr ：改变文件隐藏属性

lsattr ： 查看文件隐藏属性

#### 特殊标志位 SUID SGID SBIT

Linux 为每个文件和目录存储了 3 个额外的信息位
- **设置用户 UID**：当 s 标志出现在文件拥有者的 x 权限上，此时被称为 set uid。当文件被用户使用时，程序会以文件属主的权限运行。**SUID 仅对二进制文件生效**
- **设置组 SGID**：当 s 在群组的 x 时则称为 set gid。对文件来说，程序会以文件属主的权限运行，SGID 仅对二进制文件生效；对目录来说，目录中创建的新文件会以目录的默认属组作为默认属组。
- **粘着位 SBIT**：受限删除位。作用于其他组权限的位置，标志为 t 。当使用者在该目录下创建文件或目录时，仅有自己与 root 才能删除该文件。SBIT 目前只针对目录有效。

```shell
### 设置 SUID
chmod u+s
### SGID
chmod g+s
### SBIT
chmod o+t
```
大写的 X/S/T 含义如下：
- X：对象是目录或文件已有执行权限，则赋予执行权限。
- S/T：没有执行权限的 UID/GID 和粘置位，只有当文件的拥有者都无法执行时，才会出现。



