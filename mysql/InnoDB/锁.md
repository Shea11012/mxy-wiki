---
date created: 2022-03-30 04:09
date modified: 2022-08-05 17:42
title: 锁
---
# 锁
## 全局锁
对整个数据库加锁，多用于全库备份
命令：`flush tables with read lock`
该命令会导致 DDL，DML 不能生效，可以使用 mysqldump 参数 --single-transaction，启动事务，拿到一致性视图

## 表级锁
指定一个表加读或写锁
命令：`lock tables ... read/write`

## 行锁
`select * from t where id = 1 for update`
在 id=1 的记录上加行锁，阻止其他事务插入、更新、删除该行

## 间隙锁
间隙锁基于非唯一索引，锁定一段范围内的索引记录，使用间隙锁锁住一个区间，不包含本身。

## next-key

next-key，是行锁与间隙锁的组合，在可重复读级别下生效，它的范围包含索引记录和索引区间，是一个左开右闭区间。

next-key 主要是为了避免幻读。

在非唯一索引列上都会存在 next-key，在唯一索引（主键索引）上不存在 next-key。
