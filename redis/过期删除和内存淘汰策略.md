---
tags: []
date created: 2022-04-10 00:36
date modified: 2023-04-10 05:42
---

## 过期删除策略

redis 采用的是定期删除 + 惰性删除策略

### 定时删除

在设置 key 的过期时间时，创建一个定时事件，当时间到达，由时间处理器自动执行 key 的删除操作。

缺点：
当过期 key 比较多时，删除过期 key 可能占用相当一部分 CPU 时间，在 CPU 紧张时，将 CPU 用于删除和当前任务无关的过期键上，会对服务器的响应时间和吞吐量造成影响。

### 惰性删除

不主动删除过期键，每次从数据库访问 key 时，都检测 key 是否过期，过期则删除该 key。

缺点：
如果一个 key 已过期，而这个 key 一直没有被访问，它所占用的内存就不会被释放，造成一定的内存浪费。

### 定期删除

每隔一段时间随机从数据库中取出一定数量的 key 进行检查，并删除其中的过期 key

缺点：
难以确定删除操作执行时长和频率，如果执行太过频繁，对 CPU 不友好，执行太少，过期 key 得不到及时释放。

## 内存淘汰策略

- noeviction：默认策略，不会删除任何数据，当内存超过最大设置内存时，拒绝所有写入操作并返回客户端错误信息，此时只会响应读操作。

在设置了过期时间的数据中进行淘汰：
- volatile-lru：淘汰所有设置了过期时间的键值中，最久未使用的键值
- volatile-random：随机淘汰设置了过期时间的任意键值
- volatile-ttl：淘汰更早过期的键值

在所有数据范围内进行淘汰：
- allkeys-lru：淘汰整个键值中最久未使用的键值
- allkeys-random：随机淘汰任意键值
- allkeys-lfu：淘汰整个键值中最少使用的键值

在 redis 配置文件中，添加 `maxmemory-policy 策略`

