---
tags: []
date created: 2022-12-02 10:09
date modified: 2023-07-12 18:21
---

## Box<\T>

- 将数据存储在堆上
- 避免栈上数据拷贝
- 将动态大小变为 sized 固定大小的类型，如：递归类型
- 特征对象，因为特征对象也是 DST（动态大小类型），所以也需要将 DST 转为固定大小类型

## Deref

解引用
实现了 `deref` 特征的类型可以支持 `*` 解引用操作

## Drop

通过实现 `drop` 特征，自动释放资源

编译器不允许手动调用 `drop` 特征的 drop 方法，而是使用 `std::mem::drop` 函数

互斥的 Copy 和 Drop，因为实现了 copy 特征会被编译器隐式复制，因此非常难以预测析构函数执行时间和频率

## Rc<\T>

引用计数，当希望在堆上分配一个对象供程序的多个部分使用且无法确定哪个部分最后一个结束时，就使用 Rc 成为数据值的所有者

## Arc<\T>

Arc 是并发安全的 Rc。
这两种 RC 都是只读的，如果想要实现内部数据可修改，必须配合内部可变性 `RefCell` 或者 `Mutex`

## Cell & RefCell

提供了在拥有不可变引用的同时修改目标数据。

`Cell<T>` 适用于 T 实现 `Copy` 的情况
`RefCell` 用于引用，将借用规则从编译器推迟到程序运行期

## Weak

Weak 与 Rc 类似，但是 weak 不持有所有权，仅保存一份指向数据的弱引用。
weak 对引用的值存在性不做保证，存在返回 `Some`，不存在返回 `None`
