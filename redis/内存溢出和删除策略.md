---
date created: 2022-04-10 00:36
date modified: 2022-04-10 00:51
title: 内存溢出和删除策略
---
## 删除策略
redis 采用的是定期删除 + 惰性删除策略

- **定时删除**：设置键的过期时间同时创建一个定时器。此策略十分消耗 CPU 时间，影响服务器的吞吐量，一般不采取此策略
- **惰性删除**：获取键时，每次都检查取得的键是否过期，过期则删除。此策略浪费内存，有内存泄漏的风险。
- **定期删除**：redis 默认每个 100ms 检查，是否有过期的 key，有则删除。redis 不是每隔 100ms 将所有的键检查一次，而是随机抽取检查，随机抽查会导致很多键到时间没有删除


## 内存溢出控制策略
- noeviction：默认策略，不会删除任何数据，拒绝所有写入操作并返回客户端错误信息，此时只会响应读操作。
- volatile-lru：根据 LRU 算法删除设置了超时属性的键，直到腾出足够空间为止，如果没有可删除的键对象，回退到 noeviction 策略。
- allkeys-lru：当内存不足以容纳新写入数据时，在键空间中，移除最少使用的键，直到腾出足够空间为止。
- allkeys-random：当内存不足以容纳新写入数据时，在键空间中，随机移除某个键，直到腾出足够空间为止。
- volatile-random：随机删除过期键，直到腾出足够空间为止。
- volatile-ttl：根据键值对象的 ttl 属性，删除最近将要过期数据。如果没有，回退到 noeviction 策略。
