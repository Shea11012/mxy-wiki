---
date created: 2022-03-29 15:09
date modified: 2022-03-29 15:16
title: bufferPool
---
## Buffer Pool
buffer pool 对应一片连续的内存被划分为若干个页面，页面大小与 InnoDB 的表空间大小一致，默认是 16KB。
InnoDB 中的也被称为**缓冲页**，每一个缓冲页都包含一些控制信息，包括该页的表空间编号、页号、缓冲页在 buffer pool 中的地址、链表节点等。每个缓冲页对应的控制块信息内存大小是相同的，内存空间如下
![[Pasted image 20220329150057.png]]
碎片是因为在分配了足够多控制块和缓冲页后，剩余的空间不足以分配一个控制块和缓冲页，这时就产生了碎片。
### free 链表
刚完成初始化的 buffer pool，所有的缓冲页都是空闲的，所以每一个缓冲页对应的控制块都会加入到 free 链表中
当需要一个缓冲页时，会有一个以表空间号 + 页号作为 key，缓冲页地址作为 val 的 hash 表，通过这个 hash 表就可以拿到空闲缓冲页

### flush 链表
当修改了某个缓冲页的数据，它与磁盘上的页不一致了，就被称为脏页（dirty page）
每次修改缓冲页并不是立即刷新到磁盘，而是会使用一个 flush 链表，将被修改过的缓冲页对应控制块作为一个节点加入到链表中