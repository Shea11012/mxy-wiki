---
tags: []
date created: 2023-03-28 00:12
date modified: 2023-03-28 00:27
---

## 工具汇总

### top

>[!info]
>us：用户态 CPU 时间，不包含被调整过 nice 值的进程所占的 CPU 时间
>ni：被调整过 nice 值的进程占用的 CPU 时间
>sy：内核态 CPU 时间
>id：空闲时间，不包括等待 IO 的时间
>wa：等待 IO 的 cpu 时间
>hi：硬件中断占据的 CPU 时间
>si：软中断占据的 CPU 时间

- -p {pid}：只显示某个进程的状态

>[!tip] 交互下的命令
>c：显示完整的命令行
>M：根据常住内存（RES）用量排序
>P：根据 CPU 使用百分比大小进行排序
>S：切换到累加模式
>T：根据时间或者累计时间进行排序
>s：改变两次刷新延迟时间，默认 3s
>r：修改某个进程 nice 值

### ps

```shell
# 显示所有进程
ps -ef
# 显示所有线程
ps -eLf 或 ps -eTf
```

### sar

### pidstat

- -p {pid}：查看指定进程信息
- -U {username}：显示属于该用户的进程
- -r：内存（信息）
- -d：IO 信息
	- KB_rd/s：进程每秒从磁盘读取数据大小
	- KB_wr/s：进程每秒写入磁盘数据大小
	- KB_ccwr/s：每秒取消写请求数据大小
	- iodelay：块 IO 延迟，包括等待同步块 IO 和换入块 IO 结束时间，单位时钟周期
- -u：CPU 信息（默认）
- -R：进程的 realtime priority and scheduling policy
- -w：进程上下文切换信息
	- cswch/s：自愿进行上下文切换的次数
	- nvcswch/s：非自愿上下文切换次数
- -v：进程相关的线程数和文件描述符数量
- -s：进程 stack 所用内存信息

>[!tip] 自愿与非自愿切换
>自愿切换，是指进程无法获取所需资源，导致的上下文切换。如：IO、内存等系统资源不足时，就会发生自愿上下文切换
>非自愿切换，是指进程由于时间片已到等原因，被系统强制调度，进而发生的上下文切换。如：大量的 CPU 都在争抢 CPU 时，就容易发生非自愿上下文切换。

### pstree

以树状图显示进程信息
- -a：显示命令行参数
- -c：禁止压缩子树
- -n：通过 pid 而不是 name 对相同祖先的进程排序
- -g：显示 PGIDS
- -p：显示某个进程的进程树（包含线程）
- -T：隐藏线程

### strace 

可以对运行中的程序进程查看；在没有源代码的时候也可以查看程序的调用栈
- -f：跟踪子进程
- -t：在输出中的每一行加上时间信息
- -T：显示每个系统调用所耗时间
- -c：统计每个系统调用次数、错误次数、执行时间和执行时间占比
- -i：输出系统调用的入口指针
- -e expr：指定一个表达式来控制如何跟踪



**link**：
- [如何使用strace+pstack利器分析程序性能](https://www.cnblogs.com/bangerlee/archive/2012/04/30/2476190.html)
- 